<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XIGO - Encuesta Premium</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        xigo: '#2D5A27',
                        'xigo-light': '#f0fdf4',
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        body { background-color: #f9fafb; margin: 0; padding: 0; font-family: sans-serif; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #2D5A27; border-radius: 10px; }
        
        .header-bg {
            background-color: #2D5A27;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }
        .header-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const ADMIN_PASSWORD = "XIGO2026"; 
        const LOGO_URL = "https://i.ibb.co/SD87TqHW/Black-Modern-Minimalist-Letter-A-Logo-1-1.png"; 

        const surveyData = [
            {
                section: "Bloque 0 - Preguntas Filtro",
                title: "¬øEn los √∫ltimos 30 d√≠as, has comprado comida preparada o empacada para consumir fuera de casa?",
                options: ["Si, lo he comprado", "No, pero lo considerar√≠a si fuera conveniente", "No, no me interesa"],
                type: "single",
                terminateIf: "No, no me interesa"
            },
            {
                section: "Bloque 0 - Preguntas Filtro",
                title: "¬øCu√°l describe mejor tu situaci√≥n actual?",
                options: ["Trabajo fuera de casa", "Trabajo desde casa/online", "Trabajo mixto [Oficina + casa]", "Estudiante/ No trabajo"],
                type: "single"
            },
            {
                section: "Bloque 0 - Preguntas Filtro",
                title: "¬øCon qu√© frecuencia almuerzas fuera de casa en una semana?",
                options: ["0 veces", "1-2 veces", "3-4 veces", "5+ veces"],
                type: "single"
            },
            {
                section: "Bloque 1 - Comida",
                title: "¬øHas comprado alguna vez comida preparada para consumir despu√©s?",
                options: ["Si, regularmente", "Si, algunas veces", "No, pero me llama la atenci√≥n", "No, no me interesa"],
                type: "single"
            },
            {
                section: "Bloque 1 - Comida",
                title: "¬øEn qu√© situaciones considerar√≠as consumir comida lista durante un d√≠a laboral?",
                options: ["Con poco tiempo para salir almorzar", "Reuniones o trabajo continuo", "No alcance a cocinarme", "Para comer en la oficina", "Entre reuniones o traslados", "Para llevar a casa"],
                type: "multiple"
            },
            {
                section: "Bloque 1 - Comida",
                title: "¬øQu√© tipo de comida te genera m√°s apetito y confianza?",
                options: ["Comida tradicional ecuatoriana", "Comida casera ligera", "Bowls balanceados", "Ensaladas completas", "Sopas/cremas", "Snacks salados"],
                type: "multiple",
                max: 3
            },
            {
                section: "Bloque 3 - Precio & Elasticidad",
                title: "¬øEn promedio, cu√°nto sueles pagar hoy por tu almuerzo entre semana?",
                options: ["Menos de $4.99", "$5.99-$7.99", "$7.99-$9.99", "$9.99-$11.99", "$11.99 mas"],
                type: "single"
            },
            {
                section: "Bloque 4 - RTD",
                title: "¬øQu√© tipo de bebida lista para llevar te resultar√≠a m√°s atractiva?",
                options: ["Agua natural o saborizada", "Jugo natural prensado", "T√© fr√≠o o infusi√≥n", "Caf√© latte y Matcha", "Bebida funcional", "Bebida refrescante"],
                type: "multiple",
                max: 2
            },
            {
                section: "Perfil",
                title: "Zona donde realizas tus actividades",
                options: ["Norte", "Centro", "Sur", "Samborond√≥n", "V√≠a a la Costa", "Dur√°n"],
                type: "single"
            }
        ];

        function App() {
            const [step, setStep] = useState('survey');
            const [currentIdx, setCurrentIdx] = useState(0);
            const [answers, setAnswers] = useState({});
            const [selectedInStep, setSelectedInStep] = useState([]);
            const [email, setEmail] = useState("");
            const [isLoading, setIsLoading] = useState(false);
            const [adminClicks, setAdminClicks] = useState(0);
            
            // Simulaci√≥n de base de datos persistente en esta sesi√≥n
            const [database, setDatabase] = useState([]);

            const handleAdminAccess = () => {
                const clicks = adminClicks + 1;
                if (clicks >= 5) {
                    const p = prompt("Acceso Administrador XIGO:");
                    if (p === ADMIN_PASSWORD) setStep('admin');
                    setAdminClicks(0);
                } else {
                    setAdminClicks(clicks);
                }
            };

            const handleSelect = (val) => {
                const q = surveyData[currentIdx];
                if (q.type === 'single') {
                    setAnswers(prev => ({ ...prev, [q.title]: val }));
                    setSelectedInStep([val]);
                    if (q.terminateIf && val === q.terminateIf) {
                        setStep('terminated');
                    } else {
                        setTimeout(() => {
                            if (currentIdx < surveyData.length - 1) {
                                setCurrentIdx(currentIdx + 1);
                                setSelectedInStep([]);
                            } else {
                                setStep('email');
                            }
                        }, 350);
                    }
                } else {
                    let updated = selectedInStep.includes(val)
                        ? selectedInStep.filter(i => i !== val)
                        : (q.max && selectedInStep.length >= q.max ? selectedInStep : [...selectedInStep, val]);
                    setSelectedInStep(updated);
                    setAnswers(prev => ({ ...prev, [q.title]: updated }));
                }
            };

            const nextStep = () => {
                if (currentIdx < surveyData.length - 1) {
                    setCurrentIdx(currentIdx + 1);
                    setSelectedInStep([]);
                } else {
                    setStep('email');
                }
            };

            const submitEmail = () => {
                if (!email.includes('@')) return alert("Por favor ingresa un email v√°lido");
                setIsLoading(true);
                
                // Guardar en la "Base de Datos" local
                const newRecord = {
                    id: Date.now(),
                    email: email,
                    date: new Date().toLocaleString(),
                    responses: { ...answers }
                };
                
                setTimeout(() => {
                    setDatabase(prev => [newRecord, ...prev]);
                    setIsLoading(false);
                    setStep('success');
                }, 1500);
            };

            if (step === 'admin') {
                return (
                    <div className="p-4 sm:p-8 bg-gray-50 min-h-screen font-sans">
                        <div className="max-w-4xl mx-auto">
                            <div className="flex justify-between items-center mb-8 bg-white p-6 rounded-3xl shadow-sm border border-gray-100">
                                <div>
                                    <h1 className="text-2xl font-black text-xigo uppercase tracking-tighter">Panel de Registros XIGO</h1>
                                    <p className="text-xs text-gray-400 font-bold uppercase tracking-widest">Base de Datos Ordenada por Usuario</p>
                                </div>
                                <button onClick={() => setStep('survey')} className="bg-gray-100 hover:bg-gray-200 text-gray-600 px-6 py-2 rounded-xl font-bold transition-colors">Cerrar</button>
                            </div>

                            {database.length === 0 ? (
                                <div className="text-center py-20 bg-white rounded-[2.5rem] border-2 border-dashed border-gray-200">
                                    <p className="text-gray-400 font-bold italic">No hay registros a√∫n en esta sesi√≥n.</p>
                                </div>
                            ) : (
                                <div className="space-y-6">
                                    {database.map((user) => (
                                        <div key={user.id} className="bg-white rounded-[2rem] shadow-sm border border-gray-100 overflow-hidden fade-in">
                                            <div className="bg-xigo p-4 flex justify-between items-center">
                                                <div className="flex items-center gap-3">
                                                    <div className="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center text-white font-black text-sm">
                                                        {user.email[0].toUpperCase()}
                                                    </div>
                                                    <div>
                                                        <h3 className="text-white font-bold text-sm leading-none">{user.email}</h3>
                                                        <span className="text-white/60 text-[10px] uppercase font-bold tracking-tighter">{user.date}</span>
                                                    </div>
                                                </div>
                                                <div className="bg-white/10 px-3 py-1 rounded-full">
                                                    <span className="text-white text-[9px] font-black uppercase">ID: {user.id.toString().slice(-6)}</span>
                                                </div>
                                            </div>
                                            <div className="p-6 grid grid-cols-1 md:grid-cols-2 gap-4">
                                                {Object.entries(user.responses).map(([question, answer], idx) => (
                                                    <div key={idx} className="bg-gray-50 p-4 rounded-2xl border border-gray-100">
                                                        <p className="text-[10px] text-gray-400 font-black uppercase mb-1 leading-tight">{question}</p>
                                                        <p className="text-gray-700 font-bold text-sm">
                                                            {Array.isArray(answer) ? answer.join(", ") : answer}
                                                        </p>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen flex items-center justify-center p-2 sm:p-4 bg-gray-50 font-sans">
                    <div className="bg-white w-full max-w-lg rounded-[2.5rem] shadow-2xl overflow-hidden flex flex-col h-[750px] sm:h-[800px] border border-gray-100">
                        
                        <div onClick={handleAdminAccess} className="header-bg flex-shrink-0 h-40 sm:h-48 cursor-default">
                            <img src={LOGO_URL} alt="XIGO Header" className="header-img" />
                        </div>

                        <div className="p-6 sm:p-10 flex-grow flex flex-col overflow-hidden">
                            {step === 'survey' && (
                                <div className="fade-in flex flex-col h-full">
                                    <div className="w-full bg-gray-100 h-1 rounded-full mb-6 overflow-hidden flex-shrink-0">
                                        <div className="bg-xigo h-full transition-all duration-700" style={{ width: `${((currentIdx + 1) / surveyData.length) * 100}%` }}></div>
                                    </div>
                                    
                                    <div className="flex-grow overflow-y-auto custom-scrollbar pr-2">
                                        <p className="text-xigo font-bold text-[9px] uppercase mb-1 opacity-70 tracking-widest">{surveyData[currentIdx].section}</p>
                                        <h2 className="text-lg font-extrabold text-gray-800 leading-tight mb-6">{surveyData[currentIdx].title}</h2>
                                        
                                        <div className="space-y-2">
                                            {surveyData[currentIdx].options.map((opt, i) => (
                                                <button 
                                                    key={i} 
                                                    onClick={() => handleSelect(opt)}
                                                    className={`w-full p-4 rounded-xl text-left font-bold text-sm transition-all border-2 
                                                        ${selectedInStep.includes(opt) ? 'border-xigo bg-xigo-light text-xigo' : 'border-gray-50 bg-white text-gray-600 hover:border-gray-200'}`}
                                                >
                                                    {opt}
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="mt-4 flex-shrink-0">
                                        {surveyData[currentIdx].type === 'multiple' && selectedInStep.length > 0 && (
                                            <button onClick={nextStep} className="w-full bg-xigo text-white font-black py-4 rounded-xl shadow-lg uppercase tracking-widest">
                                                Continuar
                                            </button>
                                        )}
                                        <p className="text-center text-[9px] text-gray-300 mt-4 font-bold uppercase">Pregunta {currentIdx + 1} de {surveyData.length}</p>
                                    </div>
                                </div>
                            )}

                            {step === 'email' && (
                                <div className="fade-in text-center py-6 flex-grow flex flex-col justify-center">
                                    <div className="text-5xl mb-6">üç∑</div>
                                    <h2 className="text-2xl font-black text-gray-800 mb-4 uppercase">¬°ENCUESTA COMPLETADA!</h2>
                                    <p className="text-gray-500 text-sm mb-8 italic">Ingresa tu email para recibir un **15% de descuento** para tu compra de vino en Vina Mar√≠a.</p>
                                    <input 
                                        type="email" value={email} onChange={(e) => setEmail(e.target.value)} placeholder="tu@email.com"
                                        className="w-full p-4 rounded-xl border-2 border-gray-100 focus:border-xigo outline-none mb-4 text-center font-bold"
                                    />
                                    <button onClick={submitEmail} disabled={isLoading} className="w-full bg-xigo text-white font-black py-5 rounded-xl shadow-xl uppercase tracking-widest">
                                        {isLoading ? "PROCESANDO..." : "Recibir mi Descuento"}
                                    </button>
                                </div>
                            )}

                            {step === 'success' && (
                                <div className="fade-in text-center py-10 flex-grow flex flex-col justify-center">
                                    <div className="w-20 h-20 bg-green-100 text-xigo rounded-full flex items-center justify-center text-4xl mx-auto mb-6">‚úì</div>
                                    <h2 className="text-2xl font-black text-xigo mb-4 uppercase italic">¬°MUCHAS GRACIAS!</h2>
                                    <p className="text-gray-600 mb-8 font-medium">Tus respuestas han sido registradas. Tu cup√≥n ha sido enviado a tu correo.</p>
                                    <button onClick={() => window.location.reload()} className="text-xigo font-bold underline uppercase text-xs">Nueva Encuesta</button>
                                </div>
                            )}

                            {step === 'terminated' && (
                                <div className="fade-in text-center py-10 flex-grow flex flex-col justify-center">
                                    <h2 className="text-xl font-black text-gray-800 mb-4 uppercase">FIN DE LA ENCUESTA</h2>
                                    <p className="text-gray-500 text-sm mb-10 px-6">Gracias por tu tiempo e inter√©s.</p>
                                    <button onClick={() => window.location.reload()} className="text-xigo font-bold underline uppercase text-xs">Inicio</button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
